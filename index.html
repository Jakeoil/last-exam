<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Humanity's Last Exam</title>
<style>
  :root {
    --bg: #0e0e10;
    --surface: #1a1a2e;
    --surface2: #22223a;
    --border: #2e2e4a;
    --text: #e0e0e8;
    --text-dim: #8888a0;
    --accent: #7c6ff7;
    --accent-glow: rgba(124, 111, 247, 0.25);
    --green: #34d399;
    --red: #f87171;
    --orange: #fbbf24;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(14, 14, 16, 0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 12px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-shrink: 0;
  }

  .header-left h1 {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -0.5px;
    white-space: nowrap;
  }

  .header-left h1 span { color: var(--accent); }

  .score-display {
    display: flex;
    gap: 12px;
    font-size: 13px;
    font-weight: 600;
  }

  .score-correct { color: var(--green); }
  .score-wrong { color: var(--red); }
  .score-total { color: var(--text-dim); }

  .header-controls {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  select, .search-input {
    background: var(--surface);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 10px;
    font-size: 13px;
    outline: none;
  }

  select:focus, .search-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px var(--accent-glow);
  }

  .search-input { width: 180px; }

  .nav-row {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .nav-btn {
    background: var(--surface);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .nav-btn:hover { border-color: var(--accent); background: var(--surface2); }
  .nav-btn:disabled { opacity: 0.3; cursor: default; }

  .question-counter {
    font-size: 13px;
    color: var(--text-dim);
    min-width: 80px;
    text-align: center;
  }

  .shuffle-btn {
    background: var(--surface);
    color: var(--orange);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 6px 10px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .shuffle-btn:hover { border-color: var(--orange); }

  main {
    max-width: 860px;
    margin: 0 auto;
    padding: 32px 24px 80px;
  }

  .question-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    flex-wrap: wrap;
    gap: 8px;
  }

  .badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .badge-category {
    background: rgba(124, 111, 247, 0.15);
    color: var(--accent);
  }

  .badge-subject {
    background: rgba(52, 211, 153, 0.12);
    color: var(--green);
  }

  .badge-type {
    background: rgba(251, 191, 36, 0.12);
    color: var(--orange);
  }

  .card-body { padding: 24px 20px; }

  .question-text {
    font-size: 16px;
    line-height: 1.7;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .question-image {
    margin-top: 20px;
    text-align: center;
  }

  .question-image img {
    max-width: 100%;
    max-height: 600px;
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  .answer-section {
    padding: 20px;
    border-top: 1px solid var(--border);
  }

  .mc-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 16px;
  }

  .mc-option {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 10px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
    font-size: 14px;
    line-height: 1.5;
  }

  .mc-option:hover { border-color: var(--accent); }

  .mc-option.selected {
    border-color: var(--accent);
    background: var(--accent-glow);
  }

  .mc-option.correct {
    border-color: var(--green);
    background: rgba(52, 211, 153, 0.1);
  }

  .mc-option.wrong {
    border-color: var(--red);
    background: rgba(248, 113, 113, 0.1);
  }

  .mc-option input[type="radio"] { display: none; }

  .mc-letter {
    flex-shrink: 0;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
  }

  .selected .mc-letter { background: var(--accent); color: #fff; }
  .correct .mc-letter { background: var(--green); color: #fff; }
  .wrong .mc-letter { background: var(--red); color: #fff; }

  .exact-input {
    width: 100%;
    padding: 10px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-size: 14px;
    outline: none;
    margin-bottom: 16px;
  }

  .exact-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 2px var(--accent-glow);
  }

  .btn-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .submit-btn {
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 24px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: opacity 0.15s;
  }

  .submit-btn:hover { opacity: 0.85; }
  .submit-btn:disabled { opacity: 0.4; cursor: default; }

  .reveal-btn {
    background: transparent;
    color: var(--text-dim);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .reveal-btn:hover { border-color: var(--text-dim); color: var(--text); }

  .result-banner {
    margin-top: 16px;
    padding: 12px 16px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 600;
    display: none;
  }

  .result-banner.correct {
    display: block;
    background: rgba(52, 211, 153, 0.1);
    border: 1px solid var(--green);
    color: var(--green);
  }

  .result-banner.wrong {
    display: block;
    background: rgba(248, 113, 113, 0.1);
    border: 1px solid var(--red);
    color: var(--red);
  }

  .rationale-section {
    margin-top: 16px;
    padding: 16px;
    background: var(--surface2);
    border-radius: 8px;
    border: 1px solid var(--border);
    display: none;
  }

  .rationale-section.visible { display: block; }

  .rationale-section h4 {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-dim);
    margin-bottom: 8px;
  }

  .rationale-section p {
    font-size: 14px;
    line-height: 1.6;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .answer-display {
    margin-top: 8px;
    font-size: 14px;
    color: var(--green);
  }

  .keyboard-hint {
    position: fixed;
    bottom: 16px;
    right: 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 8px 14px;
    font-size: 11px;
    color: var(--text-dim);
    display: flex;
    gap: 12px;
  }

  kbd {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 1px 5px;
    font-family: inherit;
    font-size: 11px;
  }

  @media (max-width: 640px) {
    header { padding: 10px 12px; }
    main { padding: 16px 12px 80px; }
    .card-body { padding: 16px 14px; }
    .answer-section { padding: 14px; }
    .search-input { width: 120px; }
    .keyboard-hint { display: none; }
  }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <h1><span>HLE</span> Humanity's Last Exam</h1>
    <div class="score-display">
      <span class="score-correct" id="scoreCorrect">0 correct</span>
      <span class="score-wrong" id="scoreWrong">0 wrong</span>
      <span class="score-total" id="scoreTotal">/ 0 answered</span>
    </div>
  </div>
  <div class="header-controls">
    <select id="categoryFilter"><option value="">All Categories</option></select>
    <select id="typeFilter">
      <option value="">All Types</option>
      <option value="multipleChoice">Multiple Choice</option>
      <option value="exactMatch">Exact Match</option>
    </select>
    <input type="text" class="search-input" id="searchInput" placeholder="Search questions...">
    <button class="shuffle-btn" id="shuffleBtn" title="Shuffle">Shuffle</button>
    <div class="nav-row">
      <button class="nav-btn" id="prevBtn">&larr; Prev</button>
      <span class="question-counter" id="questionCounter">1 / 2500</span>
      <button class="nav-btn" id="nextBtn">Next &rarr;</button>
    </div>
  </div>
</header>

<main>
  <div class="question-card" id="questionCard"></div>
</main>

<div class="keyboard-hint">
  <span><kbd>&larr;</kbd> Prev</span>
  <span><kbd>&rarr;</kbd> Next</span>
  <span><kbd>Enter</kbd> Submit</span>
  <span><kbd>R</kbd> Reveal</span>
</div>

<script>
let allQuestions = [];
let filtered = [];
let currentIdx = 0;
let scores = { correct: 0, wrong: 0 };
let answered = {};  // id -> { userAnswer, correct }

async function init() {
  const resp = await fetch('questions.json');
  allQuestions = await resp.json();
  populateFilters();
  applyFilters();
  render();
  bindEvents();
}

function populateFilters() {
  const cats = [...new Set(allQuestions.map(q => q.category).filter(Boolean))].sort();
  const sel = document.getElementById('categoryFilter');
  cats.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    sel.appendChild(opt);
  });
}

function applyFilters() {
  const cat = document.getElementById('categoryFilter').value;
  const type = document.getElementById('typeFilter').value;
  const search = document.getElementById('searchInput').value.toLowerCase().trim();

  filtered = allQuestions.filter(q => {
    if (cat && q.category !== cat) return false;
    if (type && q.answer_type !== type) return false;
    if (search && !q.question.toLowerCase().includes(search) &&
        !(q.subject || '').toLowerCase().includes(search)) return false;
    return true;
  });

  if (currentIdx >= filtered.length) currentIdx = 0;
  updateCounter();
}

function updateCounter() {
  document.getElementById('questionCounter').textContent =
    filtered.length ? `${currentIdx + 1} / ${filtered.length}` : '0 / 0';
  document.getElementById('prevBtn').disabled = currentIdx <= 0;
  document.getElementById('nextBtn').disabled = currentIdx >= filtered.length - 1;
}

function updateScores() {
  document.getElementById('scoreCorrect').textContent = `${scores.correct} correct`;
  document.getElementById('scoreWrong').textContent = `${scores.wrong} wrong`;
  document.getElementById('scoreTotal').textContent = `/ ${scores.correct + scores.wrong} answered`;
}

function render() {
  const card = document.getElementById('questionCard');
  if (!filtered.length) {
    card.innerHTML = '<div class="card-body" style="text-align:center;color:var(--text-dim);padding:60px 20px;">No questions match your filters.</div>';
    updateCounter();
    return;
  }

  const q = filtered[currentIdx];
  const prev = answered[q.id];
  const isRevealed = prev && prev.revealed;
  const isAnswered = prev && prev.submitted;

  let answerHTML = '';
  if (q.answer_type === 'multipleChoice') {
    const choices = parseChoices(q.question);
    answerHTML = `<div class="mc-options" id="mcOptions">` +
      choices.map(c => {
        let cls = 'mc-option';
        if (isAnswered) {
          if (c.letter === q.answer) cls += ' correct';
          else if (prev && c.letter === prev.userAnswer) cls += ' wrong';
        } else if (prev && c.letter === prev.userAnswer) {
          cls += ' selected';
        }
        return `<label class="${cls}" data-letter="${c.letter}">
          <span class="mc-letter">${c.letter}</span>
          <span>${escapeHTML(c.text)}</span>
        </label>`;
      }).join('') + `</div>`;
  } else {
    const val = (prev && prev.userAnswer) || '';
    answerHTML = `<input type="text" class="exact-input" id="exactInput"
      placeholder="Type your answer..." value="${escapeHTML(val)}"
      ${isAnswered ? 'disabled' : ''}>`;
  }

  let resultHTML = '';
  if (isAnswered) {
    resultHTML = prev.correct
      ? `<div class="result-banner correct">Correct!</div>`
      : `<div class="result-banner wrong">Incorrect. The answer is: ${escapeHTML(q.answer)}</div>`;
  }

  let rationaleHTML = '';
  if ((isAnswered || isRevealed) && q.rationale) {
    rationaleHTML = `<div class="rationale-section visible">
      <h4>Rationale</h4>
      <p>${escapeHTML(q.rationale)}</p>
    </div>`;
  }

  if (isRevealed && !isAnswered) {
    resultHTML = `<div class="result-banner correct" style="color:var(--orange);border-color:var(--orange);background:rgba(251,191,36,0.08);">
      Answer: ${escapeHTML(q.answer)}</div>`;
  }

  const questionBody = q.answer_type === 'multipleChoice'
    ? stripChoicesFromQuestion(q.question) : q.question;

  card.innerHTML = `
    <div class="card-header">
      <div style="display:flex;gap:6px;flex-wrap:wrap;">
        ${q.category ? `<span class="badge badge-category">${escapeHTML(q.category)}</span>` : ''}
        ${q.subject ? `<span class="badge badge-subject">${escapeHTML(q.subject)}</span>` : ''}
        <span class="badge badge-type">${q.answer_type === 'multipleChoice' ? 'Multiple Choice' : 'Exact Match'}</span>
      </div>
      ${q.author ? `<span style="font-size:12px;color:var(--text-dim);">by ${escapeHTML(q.author)}</span>` : ''}
    </div>
    <div class="card-body">
      <div class="question-text">${escapeHTML(questionBody)}</div>
      ${q.image ? `<div class="question-image"><img src="${q.image}" alt="Question image" loading="lazy"></div>` : ''}
    </div>
    <div class="answer-section">
      ${answerHTML}
      <div class="btn-row">
        <button class="submit-btn" id="submitBtn" ${isAnswered ? 'disabled' : ''}>Submit</button>
        <button class="reveal-btn" id="revealBtn" ${isAnswered || isRevealed ? 'disabled' : ''}>Reveal Answer</button>
      </div>
      ${resultHTML}
      ${rationaleHTML}
    </div>
  `;

  // Bind MC click handlers
  if (q.answer_type === 'multipleChoice' && !isAnswered) {
    card.querySelectorAll('.mc-option').forEach(opt => {
      opt.addEventListener('click', () => {
        card.querySelectorAll('.mc-option').forEach(o => o.classList.remove('selected'));
        opt.classList.add('selected');
        if (!answered[q.id]) answered[q.id] = {};
        answered[q.id].userAnswer = opt.dataset.letter;
      });
    });
  }

  if (q.answer_type === 'exactMatch' && !isAnswered) {
    const inp = document.getElementById('exactInput');
    inp.addEventListener('input', () => {
      if (!answered[q.id]) answered[q.id] = {};
      answered[q.id].userAnswer = inp.value;
    });
  }

  document.getElementById('submitBtn').addEventListener('click', submit);
  document.getElementById('revealBtn').addEventListener('click', reveal);
  updateCounter();
}

function submit() {
  const q = filtered[currentIdx];
  if (!q) return;
  const prev = answered[q.id];
  if (prev && prev.submitted) return;

  const userAnswer = prev ? prev.userAnswer : '';
  if (!userAnswer) return;

  let correct = false;
  if (q.answer_type === 'multipleChoice') {
    correct = userAnswer === q.answer;
  } else {
    correct = userAnswer.trim().toLowerCase() === q.answer.trim().toLowerCase();
  }

  answered[q.id] = { userAnswer, correct, submitted: true };
  if (correct) scores.correct++;
  else scores.wrong++;
  updateScores();
  render();
}

function reveal() {
  const q = filtered[currentIdx];
  if (!q) return;
  if (!answered[q.id]) answered[q.id] = {};
  answered[q.id].revealed = true;
  render();
}

function parseChoices(text) {
  const choices = [];
  const regex = /^([A-Z])[.)]\s*(.+)/gm;
  let m;
  while ((m = regex.exec(text)) !== null) {
    choices.push({ letter: m[1], text: m[2].trim() });
  }
  return choices;
}

function stripChoicesFromQuestion(text) {
  const lines = text.split('\n');
  const result = [];
  let hitChoices = false;
  for (const line of lines) {
    if (/^Answer Choices:/.test(line.trim())) { hitChoices = true; continue; }
    if (hitChoices && /^[A-Z][.)]\s/.test(line.trim())) continue;
    if (hitChoices && line.trim() === '') { hitChoices = false; continue; }
    result.push(line);
  }
  return result.join('\n').trim();
}

function escapeHTML(s) {
  if (!s) return '';
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function bindEvents() {
  document.getElementById('prevBtn').addEventListener('click', () => { if (currentIdx > 0) { currentIdx--; render(); } });
  document.getElementById('nextBtn').addEventListener('click', () => { if (currentIdx < filtered.length - 1) { currentIdx++; render(); } });
  document.getElementById('categoryFilter').addEventListener('change', () => { applyFilters(); render(); });
  document.getElementById('typeFilter').addEventListener('change', () => { applyFilters(); render(); });

  let searchTimeout;
  document.getElementById('searchInput').addEventListener('input', () => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => { applyFilters(); render(); }, 300);
  });

  document.getElementById('shuffleBtn').addEventListener('click', () => {
    for (let i = filtered.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [filtered[i], filtered[j]] = [filtered[j], filtered[i]];
    }
    currentIdx = 0;
    render();
  });

  document.addEventListener('keydown', e => {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
      if (e.key === 'Enter') { e.preventDefault(); submit(); }
      return;
    }
    if (e.key === 'ArrowLeft') { if (currentIdx > 0) { currentIdx--; render(); } }
    else if (e.key === 'ArrowRight') { if (currentIdx < filtered.length - 1) { currentIdx++; render(); } }
    else if (e.key === 'Enter') submit();
    else if (e.key === 'r' || e.key === 'R') reveal();
    else if (q_answer_type_is_mc() && /^[a-eA-E]$/.test(e.key)) {
      const letter = e.key.toUpperCase();
      const opt = document.querySelector(`.mc-option[data-letter="${letter}"]`);
      if (opt) opt.click();
    }
  });
}

function q_answer_type_is_mc() {
  if (!filtered.length) return false;
  return filtered[currentIdx].answer_type === 'multipleChoice';
}

init();
</script>

</body>
</html>
